# tech

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨

## Understand this workspace

Run `nx graph` to see a diagram of the dependencies of the projects.

## Remote caching

Run `npx nx connect-to-nx-cloud` to enable [remote caching](https://nx.app) and make CI faster.

## Create new project

```bash
## project
npx create-nx-workspace zhi --package-manager=pnpm --preset=ts
```

## Init

```bash
## Notice: siyuan current only support two type of libs
## 1. esm with simple file bundled.So cannot import with bare names, import-map not work well
## 2. cjs with require hacker
## So full compatible lib will be `cjs with out new features like import.meta` or `single esm bundled without base import`

## core library
## https://nx.dev/packages/vite
nx g @nrwl/js:library zhi-env --publishable --importPath zhi-env --bundler=vite --unitTestRunner=vitest
nx g @nrwl/js:library zhi-log --publishable --importPath zhi-log --bundler=vite --unitTestRunner=vitest
nx g @nrwl/js:library zhi-cli --publishable --importPath=zhi-cli  --bundler=vite --unitTestRunner=vitest
nx g @nrwl/js:library zhi --publishable --importPath=zhi --bundler=vite --unitTestRunner=vitest
nx g @nrwl/js:library zhi-sdk --publishable --importPath=zhi-sdk  --bundler=vite --unitTestRunner=vitest
nx g @nrwl/js:library zhi-blog-api --publishable --importPath=zhi-blog-api  --bundler=vite --unitTestRunner=vitest
nx g @nrwl/js:library zhi-siyuan-api --publishable --importPath=zhi-siyuan-api  --bundler=vite --unitTestRunner=vitest

## Esbuild cjs lib
nx g @nrwl/js:lib zhi-server-modules-infra --bundler=esbuild

## Docs
## pnpm install @nx-plus/docusaurus --save-dev
nx g @nx-plus/docusaurus:app zhi-docs
## nx serve zhi-docs
## ----------------------------------------------------------------------------------
## pnpm install typedoc typedoc-plugin-markdown docusaurus-plugin-typedoc --save-dev

## Vue app
## https://github.com/nxext/nx-extensions/tree/main/packages/vue
pnpm add @nxext/vue -D
## Vite + Vue + SPA
nx g @nxext/vue:app zhi-web-modules-blog
## Nuxt3
nx g @nxext/vue:app zhi-server-modules-blog

## Astro app
## pnpm install -D @nxtensions/astro
## nx migrate @nxtensions/astro@latest
pnpm add @astrojs/vue @astrojs/vercel -D
nx g @nxtensions/astro:app zhi-server-modules-blog-astro

## Express server
nx g @nrwl/express:app zhi-server-modules-middleware

## Python
## https://betterprogramming.pub/poetry-python-nx-monorepo-5750d8627024
## https://github.com/lucasvieirasilva/nx-plugins/blob/main/packages/nx-python/README.md
## pnpm install @nxlv/python --save-dev
npx nx g @nxlv/python:project zhi-vuepress1-to-vuepress2 --type application --description='zhi-vuepress1-to-vuepress2' --packageName=zhi-vuepress1-to-vuepress2 --moduleName=zhi_vuepress1_to_vuepress2
```

## Setup

```
pnpm install
```

## Build

```
pmpm build
```

## Lint

```
pnpm lint
```

## Test

```
pnpm test
```

## Publish

```
nx publish zhi-env --ver=0.0.1 --tag=latest
nx publish zhi-log --ver=0.0.1 --tag=latest
nx publish zhi-cli --ver=0.0.1 --tag=latest
nx publish zhi-common --ver=0.0.1 --tag=latest
nx publish zhi --ver=0.0.1 --tag=latest
nx publish zhi-sdk --ver=0.0.1 --tag=latest
nx publish zhi-blog-api --ver=0.0.1 --tag=latest
```

## Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.

## Project Architecture

### Series Ecology

-   [zhi](https://github.com/terwer/zhi)

-   [zhi-cli](https://github.com/terwer/zhi-cli)

-   [zhi-sdk](https://github.com/terwer/zhi-sdk)

    -   [zhi-env](https://github.com/terwer/zhi-env)
    -   [zhi-log](https://github.com/terwer/zhi-log)
    -   zhi-core - event, schedule
    -   [zhi-common](https://github.com/terwer/zhi-common) - utils
    -   zhi-blog-api
        -   zhi-common-blog-api
            -   zhi-yuque-api
            -   zhi-liandi-api
            -   zhi-wechat-api
        -   zhi-metaweblog-api
            -   zhi-cnblogs-api
            -   zhi-wordpress-api
        -   zhi-siyuan-api
    -   zhi-electron - electron only api
    -   zhi-web - browser only api
    -   zhi-node - node only api
    -   zhi-mobile - mobile only api

-   [zhi-mini](https://github.com/terwer/zhi-mini)
-   [zhi-blog](https://github.com/terwer/zhi-blog)
-   [zhi-blog-astro](https://github.com/terwer/zhi-blog-astro)

### Core Framework

-   Infrastructure: [zhi-env](https://github.com/terwer/zhi-env) + [zhi-log](https://github.com/terwer/zhi-log)
-   Scaffold(zhi-cli): [zhi-cli](https://github.com/terwer/zhi-cli)
-   SDK (zhi-sdk): [zhi-sdk](https://github.com/terwer/zhi-sdk)
-   Theme (zhi-mini): [Vite](https://vitejs.dev/) + [TypeScript](https://www.typescriptlang.org/) + [Stylus](https://stylus-lang.com/)
-   Dynamic Blog (zhi-blog): [Nuxt framework](https://nuxt.com/) + [Vue3](https://vuejs.org/) + [Stylus](https://stylus-lang.com/)
-   Static Blog (zhi-blog-astro): [Astro](https://astro.build/) + [Vue3](https://vuejs.org/) + [Stylus](https://stylus-lang.com/)

The dependency relationship is as follows:

-   zhi-sdk
    -   zhi-core
    -   zhi-log
        -   zhi-env
    -   zhi-common
-   zhi-mini
    -   zhi-sdk
    -   zhi-electron
-   zhi-blog
    -   zhi-sdk
-   zhi-blog-astro
    -   zhi-sdk

Currently, `zhi-theme` = `zhi-mini`, which means that `zhi-theme` has been planned into `zhi-mini`.

### Mounted window object

```bash
windowManager
customCmd
```
